# Robur Intercept 

Плагин предназначен для диагностики моделей в среде **Robur 360**.\
Он автоматически ищет пересечения между элементами 2D/3D-моделей и
помогает пользователю локализовать коллизии.

------------------------------------------------------------------------

## Назначение

-   Анализ моделей на наличие геометрических пересечений;\
-   Вывод списка проблемных объектов;\
-   Подсветка пересечений непосредственно в окне модели;\
-   Упрощение проверки коллизий при проектировании.

------------------------------------------------------------------------

## Установка

[Установить плагин](https://360.topomatic.ru/?extensionInstallPath=https%3A%2F%2Ffangarh.github.io%2FRoburIntercept%2F)


------------------------------------------------------------------------

## Алгоритм работы

Алгоритм плагина строится на API **Robur 360** (библиотеки `wdx`, `math` и
`albatros`):

1.  **Выбор объектов пользователем**
    -   Используется `CadViewContext.getobject` и `getpoint`.\
    -   Возможна фильтрация объектов по предикатам и управление выбором
        через `AlternativeCommands`.
2.  **Диагностика пересечений**    
    -   Для проверки используются встроенные методы:
        -   `intersectObject(args, object)` --- пересечение с другим
            объектом;\
        -   `intersectSegment(args, a, b)` --- пересечение с отрезком;\
        -   `intersectArc(args, arc)` --- пересечение с дугой;\
        -   `intersectCircle(args, circle)` --- пересечение с
            окружностью.\
    -   Эти методы определяют точки пересечений и возвращают их в
        `OsnapIntersectionArgs`.
3.  **Пространственный индекс (`SpatialIndex`)**
    -   Объекты геометрии (`DwgGeometry3d`) из `wdx.d.ts` содержат поле
        `spatial`.\
    -   `SpatialIndex` позволяет эффективно находить кандидатов на
        пересечение, не проверяя все объекты:
        -   `walk(ray, visitor)` --- поиск пересечений вдоль луча;\
        -   `walk(plane, visitor)` --- обход по плоскости;\
        -   `walkBox(box, visitor)` --- выборка по ограничивающему
            объёму.\
    -   Это существенно ускоряет анализ больших моделей, так как
        пересечения проверяются только для элементов в пересекающихся
        боксах.
4.  **Вывод результатов**
    -   Используется `OutputChannel` (из `albatros.d.ts`) для текстового вывода логов;\
    -   Пересечения дополнительно визуализируются средствами диагностики.

------------------------------------------------------------------------

## Работа с исходным кодом

### Установка зависимостей

```
npm install
```

### Сборка

```
npm run build
```

### Отладка

```
npm run serve
```

------------------------------------------------------------------------

## Поддержка

Если вы нашли ошибку или хотите предложить улучшение:\
- создайте issue на GitHub;\
